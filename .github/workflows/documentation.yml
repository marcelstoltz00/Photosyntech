name: Generate Documentation

permissions:
  contents: write

on:
  push:
    branches: [ main, master, devBranch, TUI ]
  workflow_dispatch:

jobs:
  build-documentation:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Install Doxygen
      run: sudo apt-get update && sudo apt-get install -y doxygen graphviz
      
    - name: Generate Documentation
      run: doxygen Doxyfile

    - name: Debug Information
      run: |
        echo "Current directory: $(pwd)"
        git --version || true
        echo "--- git status ---"
        git status --porcelain || true
        echo "--- branches ---"
        git branch -a || true
        echo "--- remotes ---"
        git remote -v || true
        echo "--- ls docs output ---"
        ls -la ./docs/doxygen/html || true

    - name: Prepare HTML publish folder for ghaction-doxygen-ghpages
      run: |
        echo "Ensuring expected publish_dir exists for the action"
        if [ -d "./docs/doxygen/html" ]; then
          mkdir -p doc
          rm -rf doc/html
          cp -a ./docs/doxygen/html doc/html
          echo "Copied ./docs/doxygen/html -> ./doc/html"
        else
          echo "Warning: ./docs/doxygen/html not found; action may fail"
        fi
      
    - name: Doxygen and Github Pages
      uses: AgarwalSaurav/ghaction-doxygen-ghpages@v2.3.0
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        doxygen_config: Doxyfile
        publish_dir: ./docs/doxygen/html
        publish_branch: gh-pages
        allow_empty_commit: true
